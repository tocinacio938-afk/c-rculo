<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>C√≠rculo Perfecto</title>
<style>
body {
  margin: 0;
  background: #111;
  overflow: hidden;
  touch-action: none;
  font-family: Arial, sans-serif;
  color: white;
}

canvas {
  display: block;
}

#result {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

button {
  padding: 15px 25px;
  font-size: 18px;
  border: none;
  border-radius: 8px;
  margin-top: 15px;
}

#best {
  margin-top: 10px;
  font-size: 18px;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="result">
  <h1 id="score"></h1>
  <div id="best"></div>
  <button onclick="reset()">Reintentar</button>
</div>


</script>
// ===== CANVAS =====
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

// ===== ESTADO =====
let mode = "menu"; // menu | single | multi
let drawing = false;
let points = [];
let drawColor = "white";
let currentPlayer = 1;
let scores = { 1: null, 2: null };

// ===== BOTONES =====
const btnSingle = {
  x: canvas.width / 2 - 140,
  y: 260,
  w: 280,
  h: 60
};

const btnMulti = {
  x: canvas.width / 2 - 140,
  y: 350,
  w: 280,
  h: 60
};

// ===== AUDIO =====
let audioEnabled = false;
let audioContext;

function enableAudio() {
  if (!audioEnabled) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    audioContext.resume();
    audioEnabled = true;
  }
}

function playSound(type) {
  if (!audioEnabled) return;

  const osc = audioContext.createOscillator();
  const gain = audioContext.createGain();
  osc.connect(gain);
  gain.connect(audioContext.destination);

  osc.frequency.value =
    type === "bad" ? 150 : type === "ok" ? 400 : 700;

  osc.start();
  gain.gain.exponentialRampToValueAtTime(
    0.0001,
    audioContext.currentTime + 0.4
  );
}

// ===== VIBRACI√ìN =====
function vibrate(ms) {
  if (navigator.vibrate) navigator.vibrate(ms);
}

// ===== MEN√ö =====
function drawButton(btn, text) {
  ctx.fillStyle = "#222";
  ctx.fillRect(btn.x, btn.y, btn.w, btn.h);

  ctx.strokeStyle = "white";
  ctx.lineWidth = 3;
  ctx.strokeRect(btn.x, btn.y, btn.w, btn.h);

  ctx.fillStyle = "white";
  ctx.font = "26px Arial";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText(text, btn.x + btn.w / 2, btn.y + btn.h / 2);
}

function drawMenu() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "white";
  ctx.textAlign = "center";
  ctx.font = "42px Arial";
  ctx.fillText("C√çRCULO PERFECTO", canvas.width / 2, 140);

  drawButton(btnSingle, "SINGLE PLAYER");
  drawButton(btnMulti, "MULTIPLAYER");
}

// ===== GU√çA =====
function drawGuide(centerY) {
  ctx.strokeStyle = "rgba(255,255,255,0.25)";
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.arc(canvas.width / 2, centerY, 120, 0, Math.PI * 2);
  ctx.stroke();
}

// ===== INPUT =====
canvas.addEventListener("touchstart", e => {
  enableAudio();
  const t = e.touches[0];
  const x = t.clientX;
  const y = t.clientY;

  if (mode === "menu") {
    if (
      x > btnSingle.x && x < btnSingle.x + btnSingle.w &&
      y > btnSingle.y && y < btnSingle.y + btnSingle.h
    ) {
      mode = "single";
    }

    if (
      x > btnMulti.x && x < btnMulti.x + btnMulti.w &&
      y > btnMulti.y && y < btnMulti.y + btnMulti.h
    ) {
      mode = "multi";
      scores = { 1: null, 2: null };
      currentPlayer = 1;
    }
    return;
  }

  points = [];
  drawing = true;
  ctx.beginPath();
});

canvas.addEventListener("touchmove", e => {
  if (!drawing) return;

  const t = e.touches[0];
  points.push({ x: t.clientX, y: t.clientY });

  ctx.strokeStyle = drawColor;
  ctx.lineWidth = 5;
  ctx.lineTo(t.clientX, t.clientY);
  ctx.stroke();
});

canvas.addEventListener("touchend", () => {
  if (!drawing) return;
  drawing = false;

  const score = evaluateCircle();

  if (mode === "single") {
    alert(`Tu puntuaci√≥n: ${score}%`);
    mode = "menu";
  } else {
    handleMultiplayer(score);
  }
});

// ===== C√ÅLCULO =====
function evaluateCircle() {
  if (points.length < 30) return 0;

  let cx = 0, cy = 0;
  points.forEach(p => { cx += p.x; cy += p.y; });
  cx /= points.length;
  cy /= points.length;

  const d = points.map(p => Math.hypot(p.x - cx, p.y - cy));
  const avg = d.reduce((a, b) => a + b) / d.length;
  const v = d.reduce((a, b) => a + Math.abs(b - avg), 0) / d.length;

  const score = Math.max(0, Math.round(100 - v));
  const type = score < 50 ? "bad" : score < 80 ? "ok" : "good";

  drawColor = type === "bad" ? "red" : type === "ok" ? "yellow" : "lime";
  playSound(type);
  vibrate(type === "good" ? 200 : 80);

  return score;
}

// ===== MULTI =====
function handleMultiplayer(score) {
  scores[currentPlayer] = score;
  currentPlayer++;

  if (currentPlayer > 2) {
    const winner =
      scores[1] > scores[2] ? "üèÜ JUGADOR 1 GANA" :
      scores[2] > scores[1] ? "üèÜ JUGADOR 2 GANA" :
      "ü§ù EMPATE";

    alert(`J1: ${scores[1]}%\nJ2: ${scores[2]}%\n\n${winner}`);
    mode = "menu";
  }
}

// ===== LOOP =====
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (mode === "menu") drawMenu();

  if (mode === "single") drawGuide(canvas.height / 2);

  if (mode === "multi") {
    ctx.strokeStyle = "white";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(0, canvas.height / 2);
    ctx.lineTo(canvas.width, canvas.height / 2);
    ctx.stroke();

    drawGuide(canvas.height / 4);
    drawGuide((canvas.height * 3) / 4);
  }

  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
