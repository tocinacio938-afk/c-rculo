<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>C√≠rculo Perfecto</title>
<style>
body {
  margin: 0;
  background: #111;
  overflow: hidden;
  touch-action: none;
  font-family: Arial, sans-serif;
  color: white;
}

canvas {
  display: block;
}

#result {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

button {
  padding: 15px 25px;
  font-size: 18px;
  border: none;
  border-radius: 8px;
  margin-top: 15px;
}

#best {
  margin-top: 10px;
  font-size: 18px;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="result">
  <h1 id="score"></h1>
  <div id="best"></div>
  <button onclick="reset()">Reintentar</button>
</div>

<script>
<script>
alert("EL SCRIPT S√ç CARG√ì");

// resto del c√≥digo
</script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

let mode = "menu"; // menu | single | multi
let drawing = false;
let points = [];
let drawColor = "white";
let currentPlayer = 1;
let scores = { 1: null, 2: null };

// ===== AUDIO (iPhone OK) =====
let audioEnabled = false;
let audioContext;

function enableAudio() {
  if (!audioEnabled) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    audioContext.resume();
    audioEnabled = true;
  }
}

function playSound(type) {
  if (!audioEnabled) return;
  const osc = audioContext.createOscillator();
  const gain = audioContext.createGain();
  osc.connect(gain);
  gain.connect(audioContext.destination);

  osc.frequency.value =
    type === "bad" ? 150 : type === "ok" ? 400 : 700;

  osc.start();
  gain.gain.exponentialRampToValueAtTime(
    0.0001,
    audioContext.currentTime + 0.4
  );
}

// ===== VIBRACI√ìN =====
function vibrate(ms) {
  if (navigator.vibrate) navigator.vibrate(ms);
}

// ===== MEN√ö =====
function drawMenu() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = "white";
  ctx.font = "40px Arial";
  ctx.textAlign = "center";
  ctx.fillText("C√çRCULO PERFECTO", canvas.width/2, 150);

  ctx.font = "30px Arial";
  ctx.fillText("Toca para JUGAR SOLO", canvas.width/2, 300);
  ctx.fillText("Toca abajo para MULTIPLAYER", canvas.width/2, 380);
}

// ===== GU√çA =====
function drawGuide(yOffset, height) {
  ctx.strokeStyle = "rgba(255,255,255,0.2)";
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.arc(canvas.width/2, yOffset + height/2, 120, 0, Math.PI*2);
  ctx.stroke();
}

// ===== EVENTOS =====
canvas.addEventListener("touchstart", e => {
  enableAudio();

  if (mode === "menu") {
    const y = e.touches[0].clientY;
    if (y < canvas.height/2) {
      mode = "single";
    } else {
      mode = "multi";
      scores = {1:null, 2:null};
      currentPlayer = 1;
    }
    return;
  }

  points = [];
  drawing = true;
  ctx.beginPath();
});

canvas.addEventListener("touchmove", e => {
  if (!drawing) return;
  const t = e.touches[0];
  points.push({ x: t.clientX, y: t.clientY });

  ctx.strokeStyle = drawColor;
  ctx.lineWidth = 5;
  ctx.lineTo(t.clientX, t.clientY);
  ctx.stroke();
});

canvas.addEventListener("touchend", () => {
  if (!drawing) return;
  drawing = false;
  const score = evaluateCircle();
  if (mode === "single") showResult(score);
  else handleMultiplayer(score);
});

// ===== EVALUAR =====
function evaluateCircle() {
  if (points.length < 30) return 0;

  let cx = 0, cy = 0;
  points.forEach(p => { cx += p.x; cy += p.y; });
  cx /= points.length;
  cy /= points.length;

  let distances = points.map(p => Math.hypot(p.x-cx, p.y-cy));
  let avg = distances.reduce((a,b)=>a+b)/distances.length;
  let variance = distances.reduce((a,b)=>a+Math.abs(b-avg),0)/distances.length;

  let score = Math.max(0, Math.round(100 - variance));

  let type = score < 50 ? "bad" : score < 80 ? "ok" : "good";
  drawColor = type === "bad" ? "red" : type === "ok" ? "yellow" : "lime";

  playSound(type);
  vibrate(type === "good" ? 200 : 80);

  return score;
}

// ===== RESULTADOS =====
function showResult(score) {
  alert(`Tu puntuaci√≥n: ${score}%`);
  mode = "menu";
}

function handleMultiplayer(score) {
  scores[currentPlayer] = score;
  currentPlayer++;

  if (currentPlayer > 2) {
    let winner =
      scores[1] > scores[2] ? "Jugador 1 üèÜ" :
      scores[2] > scores[1] ? "Jugador 2 üèÜ" :
      "Empate ü§ù";

    alert(
      `J1: ${scores[1]}%\nJ2: ${scores[2]}%\n\n${winner}`
    );
    mode = "menu";
  }
}

// ===== LOOP =====
function loop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if (mode === "menu") {
    drawMenu();
  }

  if (mode === "multi") {
    ctx.strokeStyle = "white";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(0, canvas.height/2);
    ctx.lineTo(canvas.width, canvas.height/2);
    ctx.stroke();

    drawGuide(0, canvas.height/2);
    drawGuide(canvas.height/2, canvas.height/2);
  }

  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
