<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>C√≠rculo Perfecto</title>
<style>
body {
  margin: 0;
  background: #111;
  overflow: hidden;
  touch-action: none;
  font-family: Arial, sans-serif;
  color: white;
}

canvas {
  display: block;
}

#result {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

button {
  padding: 15px 25px;
  font-size: 18px;
  border: none;
  border-radius: 8px;
  margin-top: 15px;
}

#best {
  margin-top: 10px;
  font-size: 18px;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="result">
  <h1 id="score"></h1>
  <div id="best"></div>
  <button onclick="reset()">Reintentar</button>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

let drawing = false;
let points = [];
let drawColor = "white";

// üîä sonidos (frecuencias)
function playSound(type) {
  const audio = new AudioContext();
  const osc = audio.createOscillator();
  const gain = audio.createGain();
  osc.connect(gain);
  gain.connect(audio.destination);

  if (type === "bad") osc.frequency.value = 150;
  if (type === "ok") osc.frequency.value = 400;
  if (type === "good") osc.frequency.value = 700;

  osc.start();
  gain.gain.exponentialRampToValueAtTime(
    0.0001,
    audio.currentTime + 0.5
  );
}

// üèÜ mejor puntuaci√≥n
let bestScore = localStorage.getItem("bestCircle") || 0;

canvas.addEventListener("touchstart", () => {
  points = [];
  drawing = true;
  ctx.beginPath();
});

canvas.addEventListener("touchmove", e => {
  if (!drawing) return;
  const t = e.touches[0];
  points.push({ x: t.clientX, y: t.clientY });

  ctx.lineWidth = 5;
  ctx.strokeStyle = drawColor;
  ctx.lineTo(t.clientX, t.clientY);
  ctx.stroke();
});

canvas.addEventListener("touchend", () => {
  drawing = false;
  evaluateCircle();
});

function evaluateCircle() {
  if (points.length < 20) return;

  let cx = 0, cy = 0;
  points.forEach(p => { cx += p.x; cy += p.y; });
  cx /= points.length;
  cy /= points.length;

  let distances = points.map(p =>
    Math.hypot(p.x - cx, p.y - cy)
  );

  let avg = distances.reduce((a,b)=>a+b) / distances.length;
  let variance = distances.reduce((a,b)=>a + Math.abs(b - avg), 0) / distances.length;

  let score = Math.max(0, 100 - variance);
  score = Math.round(score);

  let color, sound;
  if (score < 50) { color = "red"; sound = "bad"; }
  else if (score < 80) { color = "yellow"; sound = "ok"; }
  else { color = "lime"; sound = "good"; }

  playSound(sound);

  if (score > bestScore) {
    bestScore = score;
    localStorage.setItem("bestCircle", bestScore);
  }

  document.getElementById("score").innerHTML =
    `<span style="color:${color}">Tu c√≠rculo fue ${score}% perfecto</span>`;

  document.getElementById("best").innerHTML =
    `üèÜ Mejor puntuaci√≥n: <b>${bestScore}%</b>`;

  drawColor = color;
  document.getElementById("result").style.display = "flex";
}

function reset() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  document.getElementById("result").style.display = "none";
  drawColor = "white";
}
</script>

</body>
</html>
