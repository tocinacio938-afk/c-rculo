<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>C√≠rculo Perfecto</title>
<style>
body {
  margin: 0;
  background: #111;
  overflow: hidden;
  touch-action: none;
  font-family: Arial, sans-serif;
  color: white;
}

canvas {
  display: block;
}

#result {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

button {
  padding: 15px 25px;
  font-size: 18px;
  border: none;
  border-radius: 8px;
  margin-top: 15px;
}

#best {
  margin-top: 10px;
  font-size: 18px;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="result">
  <h1 id="score"></h1>
  <div id="best"></div>
  <button onclick="reset()">Reintentar</button>
</div>


</script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

// ===== ESTADO =====
let mode = "menu";
let drawing = false;
let points = [];
let drawColor = "white";
let currentPlayer = 1;
let scores = {1:null, 2:null};

// ===== AUDIO =====
let audioEnabled = false;
let audioContext;

function enableAudio() {
  if (!audioEnabled) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    audioContext.resume();
    audioEnabled = true;
  }
}

function playSound(type) {
  if (!audioEnabled) return;
  const osc = audioContext.createOscillator();
  const gain = audioContext.createGain();
  osc.connect(gain);
  gain.connect(audioContext.destination);

  osc.frequency.value = type==="bad"?150:type==="ok"?400:700;
  osc.start();
  gain.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.4);
}

// ===== BOTONES (SIEMPRE CENTRADOS) =====
function getButtons() {
  return {
    single: {
      x: canvas.width/2 - 150,
      y: canvas.height/2 - 80,
      w: 300,
      h: 60
    },
    multi: {
      x: canvas.width/2 - 150,
      y: canvas.height/2 + 10,
      w: 300,
      h: 60
    }
  };
}

// ===== DIBUJAR =====
function drawButton(b, text) {
  ctx.fillStyle = "#222";
  ctx.fillRect(b.x, b.y, b.w, b.h);
  ctx.strokeStyle = "white";
  ctx.lineWidth = 3;
  ctx.strokeRect(b.x, b.y, b.w, b.h);
  ctx.fillStyle = "white";
  ctx.font = "26px Arial";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText(text, b.x + b.w/2, b.y + b.h/2);
}

function drawMenu() {
  const btn = getButtons();
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = "white";
  ctx.textAlign = "center";
  ctx.font = "42px Arial";
  ctx.fillText("C√çRCULO PERFECTO", canvas.width/2, 140);

  drawButton(btn.single, "SINGLE PLAYER");
  drawButton(btn.multi, "MULTIPLAYER");
}

function drawGuide(y) {
  ctx.strokeStyle = "rgba(255,255,255,0.25)";
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.arc(canvas.width/2, y, 120, 0, Math.PI*2);
  ctx.stroke();
}

// ===== INPUT =====
canvas.addEventListener("touchstart", e => {
  enableAudio();
  const t = e.touches[0];
  const x = t.clientX;
  const y = t.clientY;
  const btn = getButtons();

  if (mode === "menu") {
    if (x>btn.single.x && x<btn.single.x+btn.single.w &&
        y>btn.single.y && y<btn.single.y+btn.single.h) {
      mode = "single";
    }

    if (x>btn.multi.x && x<btn.multi.x+btn.multi.w &&
        y>btn.multi.y && y<btn.multi.y+btn.multi.h) {
      mode = "multi";
      scores = {1:null, 2:null};
      currentPlayer = 1;
    }
    return;
  }

  points = [];
  drawing = true;
  ctx.beginPath();
});

canvas.addEventListener("touchmove", e => {
  if (!drawing) return;
  const t = e.touches[0];
  points.push({x:t.clientX, y:t.clientY});
  ctx.strokeStyle = drawColor;
  ctx.lineWidth = 5;
  ctx.lineTo(t.clientX, t.clientY);
  ctx.stroke();
});

canvas.addEventListener("touchend", () => {
  if (!drawing) return;
  drawing = false;
  const score = evaluate();

  if (mode === "single") {
    alert(`Puntuaci√≥n: ${score}%`);
    mode = "menu";
  } else {
    scores[currentPlayer] = score;
    currentPlayer++;
    if (currentPlayer > 2) {
      const win =
        scores[1]>scores[2]?"üèÜ JUGADOR 1":
        scores[2]>scores[1]?"üèÜ JUGADOR 2":
        "ü§ù EMPATE";
      alert(`J1: ${scores[1]}%\nJ2: ${scores[2]}%\n${win}`);
      mode = "menu";
    }
  }
});

// ===== SCORE =====
function evaluate() {
  if (points.length < 30) return 0;
  let cx=0, cy=0;
  points.forEach(p=>{cx+=p.x; cy+=p.y});
  cx/=points.length; cy/=points.length;
  const d=points.map(p=>Math.hypot(p.x-cx,p.y-cy));
  const avg=d.reduce((a,b)=>a+b)/d.length;
  const v=d.reduce((a,b)=>a+Math.abs(b-avg),0)/d.length;
  const score=Math.max(0,Math.round(100-v));
  const type=score<50?"bad":score<80?"ok":"good";
  drawColor=type==="bad"?"red":type==="ok"?"yellow":"lime";
  playSound(type);
  return score;
}

// ===== LOOP =====
function loop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if (mode==="menu") drawMenu();
  if (mode==="single") drawGuide(canvas.height/2);
  if (mode==="multi") {
    ctx.strokeStyle="white";
    ctx.lineWidth=4;
    ctx.beginPath();
    ctx.moveTo(0,canvas.height/2);
    ctx.lineTo(canvas.width,canvas.height/2);
    ctx.stroke();
    drawGuide(canvas.height/4);
    drawGuide(canvas.height*3/4);
  }
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
